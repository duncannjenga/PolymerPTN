<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-dropdown-input/paper-dropdown-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/vaadin-dialog/vaadin-dialog.html">
<link rel="import" href="../bower_components/vaadin-button/vaadin-button.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/vaadin-text-field/vaadin-text-field.html">
<link rel="import" href="../bower_components/vaadin-lumo-styles/icons.html">
<link rel="import" href="../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../bower_components/vaadin-notification/vaadin-notification.html">
<link rel="import" href="../bower_components/range-datepicker/range-datepicker-input.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/vaadin-dropdown-menu/vaadin-dropdown-menu.html">
<link rel="import" href="../bower_components/vaadin-item/vaadin-item.html">
<link rel="import" href="../bower_components/vaadin-list-box/vaadin-list-box.html">
<link rel="import" href="../bower_components/vaadin-combo-box/vaadin-combo-box.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="my-icons.html">
<link rel="import" href="short-unique-id.html">

<script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>


<dom-module id="my-allocation-add">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }
            app-header {
                color: rgb(255, 255, 255);
                background-color: darkorange;
            }

            app-header paper-icon-button {
                --paper-icon-button-ink-color: #000000;
            }

            app-drawer-layout:not([narrow]) [drawer-toggle] {
                display: none;
            }

            app-drawer {
                --app-drawer-content-container: {
                    background-color: #F4F5F6;
                }
            }
            paper-fab.fab {
                position: fixed;
                bottom: 30px;
                right: 30px;
                background-color: darkorange;
            }
            @media (max-width: 768px) {
                #buttonform {
                    display: none;

                }
                iron-icon#iconform {
                    display: inline-block;
                }
                #iconcreated {
                    display: inline-block
                }
                #created {
                    display: none;
                }
            }

            @media (min-width: 768px) {
                .docu {
                    /* margin-left: 16px;
                    margin-right: 16px; */
                    padding: 16px;
                }
                #iconform {
                    display: none;
                }
            }
            hr {
                background-color: #eee;
                border: 0 none;
                color: #eee;
                height: 1px;
            }
        </style>
        <iron-ajax auto url="/hotel/read" handle-as="json" on-response="_hotelLoaded" debounce-duration="300"></iron-ajax>
        <iron-ajax id="ajaxRoom" handle-as="json" on-response="_roomsLoaded"></iron-ajax>
 
        <app-drawer-layout fullbleed narrow="{{narrow}}" id="drawerLayout">
            <app-header-layout id="appheader" has-scrolling-region>
                <app-header fixed slot="header">
                    <app-toolbar>
                        <a href="/allocation">
                            <paper-icon-button noink class="menu" style="color: white;" icon="my-icons:arrow-back"></paper-icon-button>
                        </a>
                        <div main-title>New Allocation</div>
                    </app-toolbar>

                    <vaadin-dialog id="successModal" no-close-on-esc no-close-on-outside-click>
                        <template>
                            <h3 style="text-align: center">Successfully Added.</h3>
                            <hr>
                            <paper-button on-tap="_ok" style="float: right">Ok</paper-button>
                        </template>
                    </vaadin-dialog>
                </app-header>

                <div class="docu">

                    <div class="docu-header">
                        <div>
                            <iron-icon id="iconcreated" icon="my-icons:flag" style="color:gray;"></iron-icon>
                            <span id="created">Created by:</span> Jeino
                            <!-- user name here {{username}} or something -->
                        </div>

                        <div>
                            <paper-toggle-button style="position: relative; left:700px; top: 10px;" value="{{active}}" id="active" on-tap="_active">ACTIVE</paper-toggle-button>
                        </div>
                        <div style="position: absolute; top: 20px; right: 145px;">
                            <paper-dropdown-menu style="cursor:pointer;width:150px;" label="Workspace" searchable>
                                <paper-listbox attr-for-selected="name" slot="dropdown-content" class="dropdown-content" selected="{{workspace}}">
                                    <paper-item name="PTN">PTN</paper-item>
                                    <paper-item name="Tabikupo">Tabikupo</paper-item>
                                </paper-listbox>
                            </paper-dropdown-menu>
                        </div>


                    </div>

                    <div class="details" id="form">
                        <!-- <paper-input always-float-label value={{hotel}} label="HOTEL"></paper-input> -->

                        <paper-dropdown-input always-float-label style="width: 100%" label="Hotel" items='[[hotelItems]]' filter-property="hotel" value="{{hotel}}">
                            <template>
                                <template is="dom-repeat" items="[[items]]" as="item">
                                    <paper-item>[[item.hotel]]</paper-item>
                                </template>
                            </template>
                        </paper-dropdown-input>

                        <paper-textarea always-float-label value="{{note}}" label="REMARKS" style="width: 49%; float: right;"></paper-textarea>
                        <range-datepicker-input class="" date-format="DD-MMMM-YYYY" style="width: 49%; ">
                            <template>
                                <div id="daterange">
                                    <paper-input label="DURATION" value="{{dateFrom}} - {{dateTo}}"></paper-input>
                                    <paper-input label="Date To" value="{{dateTo}}" hidden></paper-input>
                                </div>

                            </template>
                        </range-datepicker-input>
                        <br>

                        <vaadin-combo-box id="room"  style="width: 160px;" always-float-label  label="ROOM" items='[[roomItems]]' filter-property="hotel" value="{{room}}">
                            
                              <template is="dom-repeat" items="[[items]]" as="item">
                                  <paper-item>[[item]]</paper-item>
                              </template>
                        </vaadin-combo-box>
                        <!-- <vaadin-combo-box id="room"  style="width: 160px;" always-float-label  label="ROOM"></vaadin-combo-box> -->

                        <!-- <vaadin-text-field style="width: 130px;" id="room" value="{{room}}" label="ROOM"></vaadin-text-field> -->
                        <vaadin-text-field style="width: 130px;" id="peak" value="{{peak}}" label="PEAK"></vaadin-text-field>
                        <vaadin-text-field style="width: 130px;" id="pdays" value="{{pdays}}" label="CUT-OFF"></vaadin-text-field>
                        <vaadin-text-field style="width: 130px;" id="nonpeak" value="{{nonpeak}}" label="NON-PEAK"></vaadin-text-field>
                        <vaadin-text-field style="width: 130px;" id="nonpdays" value="{{nonpdays}}" label="NONPEAKDAYS"></vaadin-text-field>

                        <vaadin-button id="addr" on-click="_add">Add More</vaadin-button>


                        <br>

                        <div class="griddiv">
                            <span>

                                <vaadin-text-field style="width: 130px;" value="Room" readonly></vaadin-text-field>
                                <vaadin-text-field style="width: 130px;" value="Peak" readonly></vaadin-text-field>
                                <vaadin-text-field style="width: 130px;" value="Cut-Off" readonly></vaadin-text-field>
                                <vaadin-text-field style="width: 130px;" value="Non-Peak" readonly></vaadin-text-field>
                                <vaadin-text-field style="width: 130px;" value="Non-Peak Days" readonly></vaadin-text-field>

                            </span>
                            <br>
                            <span id="writeHere"></span>
                        </div>

                        <br>

                        <div>
                            <h3>PEAK SEASONS</h3>
                        </div>
                        <div style="margin-bottom: 20px">
                            <vaadin-date-picker placeholder="Start" id="startdate" value="{{startValue}}" max="{{endValue}}" date-format="DD-MMMM-YYYY"></vaadin-date-picker>
                            <vaadin-date-picker placeholder="End" id="enddate" value="{{endValue}}" min="{{startValue}}" date-format="DD-MMMM-YYYY"></vaadin-date-picker>

                            <vaadin-button on-click="_adddate">Add More</vaadin-button>
                            <br>
                            <div class="griddiv">
                                <span>
                                    <td>
                                        <vaadin-text-field style="width: 192px;" value="Peak Start" readonly></vaadin-text-field>
                                    </td>
                                    <td>
                                        <vaadin-text-field style="width: 192px;" value="Peak End" readonly></vaadin-text-field>
                                    </td>

                                </span>
                                <br>
                                <span id="writeHeredate"></span>
                            </div>

                            <br>
                        </div>
                    </div>


                </div>
                <paper-fab on-tap="_submit" style=" float: right; " class="fab" icon="my-icons:save"></paper-fab>
            </app-header-layout>
        </app-drawer-layout>
        <iron-ajax verbose id="ajax" method="[[method]]" on-response="_handleResponse"></iron-ajax>
    </template>

    <script>
        Polymer({
            is: 'my-allocation-add',
            properties: {

                selectActive: {
                    type: Boolean,
                    value: false,
                    notify: true
                },
                idnum: {
                    type: Number,
                    value: 1
                },
                idnumdate: {
                    type: Number,
                    value: 1
                },
                dateCreated: String,
                msg: String,
                created_by: {
                    type: String,
                    value: 'Peter Villaceran'
                },
                updated_by: {
                    type: String,
                    value: 'Ardie Derrayal'
                },
                rooms: {
                    type:Array,
                    value:[]
                },
                seasondate:{
                    type:Array,
                    value:[]
                },
                hotelData: {
                    type: Array,
                    notify: true,
                    value: [],
                },
                hotelId: String,
            },
            observers: ['_hotelChanged(hotel)'],
            _hotelChanged(e) {
               var r = Polymer.dom(this.root).querySelector("#writeHere").innerHTML = null;
               var d = Polymer.dom(this.root).querySelector("#writeHeredate").innerHTML = null;
                this.room = null;
                this.peak = null;
                this.pdays = null;
                this.nonpeak = null;
                this.nonpdays = null;
                this.startValue = null;
                this.endValue = null;
                this.$.ajaxRoom.method = 'GET';
                this.$.ajaxRoom.url = '/hotel/filter/' + e;
         
                this.$.ajaxRoom.generateRequest();
            },
            _active() {
                // console.log(this.selectActive);
                // this.selectActive = true;
                // console.log(this.selectActive);
                this.$.active.checked;
                console.log(this.$.active.checked);
            },
            _console(e) {
                console.log(e);
                return e;
            },       
            _add() {

                if (this.room !== '' && this.peak !== '' && this.pdays !== '' && this.nonpeak !== '' && this.nonpdays !== '') {

                this.addAllocation = true;
                var allocationval = [];
                var room1 = Polymer.dom(this.root).querySelector("#room");
                var peaksn = Polymer.dom(this.root).querySelector("#peak");
                var cutoff = Polymer.dom(this.root).querySelector("#pdays");
                var nonpeakssn = Polymer.dom(this.root).querySelector("#nonpeak");
                var nonpeakday = Polymer.dom(this.root).querySelector("#nonpdays");
 

                    var room1 = Polymer.dom(this.root).querySelector("#room");
                    var peaksn = Polymer.dom(this.root).querySelector("#peak");
                    var cutoff = Polymer.dom(this.root).querySelector("#pdays");
                    var nonpeakssn = Polymer.dom(this.root).querySelector("#nonpeak");
                    var nonpeakday = Polymer.dom(this.root).querySelector("#nonpdays");

                     var rooms = {
                        room: this.room,
                        peak: this.peak,
                        pdays: this.pdays,
                        nonpeak: this.nonpeak,
                        nonpdays: this.nonpdays
                    }

                    this.rooms.push(rooms);

                    // console.log(room1.value,peaksn.value,cutoff.value,nonpeakssn.value,nonpeakday.value);
                    var fieldbody = '<span><td><vaadin-text-field style="width: 130px;" id="room' + this.idnum + '" value="' + room1.value + '" ></vaadin-text-field></td><td> <vaadin-text-field style="width: 130px;" id="peak' + this.idnum + '" value="' + peaksn.value + '" ></vaadin-text-field></td><td> <vaadin-text-field style="width: 130px;" id="pdays' + this.idnum + '" value="' + cutoff.value + '" ></vaadin-text-field></td><td> <vaadin-text-field style="width: 130px;" id="nonpeak' + this.idnum + '" value="' + nonpeakssn.value + '" ></vaadin-text-field></td><td> <vaadin-text-field style="width: 130px;" id="nonpdays' + this.idnum + '" value="' + nonpeakday.value + '"></vaadin-text-field></td> <paper-icon-button icon="my-icons:close" style="color:red;"></paper-icon-button></span><br>'
                    var node = Polymer.dom(this.root).querySelector("#writeHere").innerHTML += fieldbody;
                    this.room = '';
                    this.peak = '';
                    this.pdays = '';
                    this.nonpeak = '';
                    this.nonpdays = '';
                    this.nonpdays = '';
                    this.idnum = this.idnum + 1;
                } else {
                    alert('Please Input All');
                }
            },
            _adddate() {
                if (this.startValue !== '' && this.endValue !== '') {

                    var datestart = Polymer.dom(this.root).querySelector("#startdate");
                    var dateend = Polymer.dom(this.root).querySelector("#enddate");

             
             var seasondate =
                    {
                        startValue: this.startValue,
                        endValue: this.endValue
                    }

                    this.seasondate.push(seasondate);

                    var node = Polymer.dom(this.root).querySelector("#writeHeredate").innerHTML += '<span><td><vaadin-date-picker placeholder="Start" id="startdate' + this.idnumdate + '" value="' + datestart.value + '" max="' + dateend.value + '" date-format="DD-MMMM-YYYY" ></vaadin-date-picker></td> <td> <vaadin-date-picker placeholder="End" id="enddate' + this.idnumdate + '" value="' + dateend.value + '" min="' + datestart.value + '" date-format="DD-MMMM-YYYY" ></vaadin-date-picker></td> <paper-icon-button icon="my-icons:close" style="color:red;"></paper-icon-button></span><br> \r\n';

                    this.startValue = '';
                    this.endValue = '';
                    this.idnumdate = this.idnumdate + 1;

                } else {
                    alert('Please Input All');
                }
            },
            _submit() {

                if (!this.hotel || !this.dateFrom || !this.dateTo || !this.note || !this.workspace) {
                    this.msg = "All fields required";
                    alert(this.msg);
                }
                else {

                    // console.log(this.rooms);
                    var active = this.$.active.checked;

                    this.method = 'POST';
                    this.$.ajax.url = '/allocation/add';
                    this.$.ajax.contentType = "application/json";


                    this.$.ajax.body = {
                        active: active,
                        workspace: this.workspace,
                        hotel: this.hotel,
                        dateFrom: this.dateFrom,
                        dateTo: this.dateTo,
                        rooms: this.rooms,
                        note: this.note,
                        seasondate: this.seasondate
                    };
                    this.$.ajax.generateRequest();
                    this.$.successModal.opened = true;
                    this.url = '';

                }
            },
            _ok() {
                this.$.successModal.opened = false;
                window.location.assign('/allocation');
            },
            toggleDrawer() { },
            _cancel() { },
            ready() {
                this.fullname = "";
                this.room = "";
                this.msg = "";
                this.url = '/hotel/read';
            },
          
            _hotelLoaded(data){
                this.hotelItems = data.detail.response.data;
            },
            _roomsLoaded(data) {
     
                    this.roomItems = data.detail.response.data.room;
  
                }
        })
    </script>
</dom-module>