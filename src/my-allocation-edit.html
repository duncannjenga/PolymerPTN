<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-dropdown-input/paper-dropdown-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/range-datepicker/range-datepicker-input.html">
<link rel="import" href="../bower_components/range-datepicker/range-datepicker-calendar.html">
<link rel="import" href="../bower_components/range-datepicker/range-datepicker-behavior.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="my-icons.html">
<link rel="import" href="short-unique-id.html">
<link rel="import" href="time-element.html">

<script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>


<dom-module id="my-allocation-edit">
    <template>
        <style include="shared-styles">
            :host {
                display: block;

                padding: 10px;
            }

            app-drawer-layout:not([narrow]) [drawer-toggle] {
                display: none;
            }

            @media (max-width: 420px) {
                .groupdiv {
                    position: absolute;
                    top: 20px;
                    right: -70px;
                }

            }

            @media (min-width: 768px) {
                .groupdiv {
                    position: absolute;
                    top: 30px;
                    display: flex;
                    /* right: 140px; */
                }
            }

            app-header {
                color: rgb(255, 255, 255);
                background-color: darkorange;
            }

            paper-button {
                height: 32px;
                background-color: cornflowerblue;
                color: white;
            }

            paper-button#button {
                height: 32px;
                background-color: white;
            }

            .card1 {
                margin: 8px;
                color: #757575;
                background-color: #fff;
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }

            table {
                border-collapse: collapse;
                width: 100%;
                font-size: small;
            }

            table#allocrooms th {
                background-color: lavender;
                text-align: center;
                font-size: medium;
                padding: 8px;

            }

            table#allocseason th {
                background-color: lavender;
                text-align: center;
                font-size: medium;
                padding: 8px;
            }

            hr {
                background-color: rgb(238, 238, 238);
                border: 0 none;
                color: #eee;
                height: 1px;
            }

            tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            paper-fab.blue {
                position: fixed;
                bottom: 30px;
                right: 30px;
                background-color: darkorange;
            }
        </style>
        <iron-ajax id="getdata" url="/allocation/readEdit/{{editKey}}" method="GET" params='{}' handle-as="json" on-response="_allocationLoaded"
            loading="{{loadingData}}" debounce-duration="300"></iron-ajax>
        <iron-ajax id="ajaxRoom" handle-as="json" on-response="_roomsLoaded"></iron-ajax>
        <iron-ajax auto url="{{urluser}}" params='{}' handle-as="json" on-response="_userLoaded"></iron-ajax>
        <iron-ajax auto url="/group/read" handle-as="json" on-response="_groupLoaded" debounce-duration="300"></iron-ajax>
        <app-drawer-layout fullbleed narrow="{{narrow}}" id="drawerLayout">
            <app-header-layout id="appheader" has-scrolling-region>
                <app-header fixed slot="header">
                    <app-toolbar>
                        <a href$="{{_getEditPrevRouteLink(prevRoute)}}">
                            <paper-icon-button noink class="menu" style="color: white;" icon="my-icons:arrow-back"></paper-icon-button>
                        </a>
                        <div main-title>Edit Allocation</div>
                        <paper-icon-button class="menu" icon="my-icons:delete-forever" on-tap="_openDelete"></paper-icon-button>
                    </app-toolbar>
                </app-header>
                <div class="docu">
                    <div class="docu-header">
                        <div class="groupdiv">
                            <paper-input always-float-label label="Group" value="{{prevRoute}}" style="width:100px;" readonly></paper-input>
                            <paper-input id="remarks" always-float-label value="{{note}}" label="REMARKS" style="width: 310px;float: right;margin-left: 95%;margin-right: -100%;">
                                <iron-icon icon="my-icons:note-add" slot="prefix" style="width:18px;height:18px;"></iron-icon>
                            </paper-input>
                        </div>
                    </div>
                    <div class="details" id="form">
                        <div style="display:flex">
                            <paper-input always-float-label value="{{hotel}}" hidden></paper-input>
                            <paper-input always-float-label value="{{hotelname}}" label="HOTEL" readonly style="width:350px;"></paper-input>
                            <range-datepicker-input id="rangeDate" class="" date-format="DD-MMM-YYYY" style="width: 55%;margin-left: 10px; ">
                                <template>
                                    <div id="daterange">
                                        <paper-input label="DURATION" value="{{dateFrom}} ~ {{dateTo}}"></paper-input>
                                        <paper-input label="Date To" value="{{dateTo}}" hidden></paper-input>
                                    </div>
                                </template>
                            </range-datepicker-input>
                        </div>
                        <paper-input id="pk-off" always-float-label value="{{pk_coff}}" label="PEAK CUT-OFF" style="width: 31%; float: left;"></paper-input>
                        <paper-input id="npk-off" always-float-label value="{{npk_coff}}" label="NON-PEAK CUT-OFF" style="width: 31%; float: left; margin-left: 10px;"></paper-input>
                        <paper-input id="high-off" always-float-label value="{{high_coff}}" label="HIGH CUT-OFF" style="width: 31%; float: left; margin-left: 10px;"></paper-input>
                        <br>
                        <div style="margin-bottom:30px;">
                            <paper-dropdown-input id="room" always-float-label style="width:283px;float: left;" label="Room" items='[[roomItems]]' filter-property="room">
                                <template>
                                    <template is="dom-repeat" items="[[items]]" as="item">
                                        <paper-item label="[[item.room]]">[[item.name]]</paper-item>
                                    </template>
                                </template>
                            </paper-dropdown-input>
                            <paper-input type="number" style="float:left; width: 130px;margin-left:10px" id="pk" always-float-label label="Peak"></paper-input>
                            <paper-input type="number" style="float:left; width: 130px;margin-left: 10px;" id="npk" always-float-label label="Non-Peak"></paper-input>
                            <paper-input type="number" style="float:left; width: 130px;margin-left: 10px;" id="high" always-float-label label="High"></paper-input>
                            <paper-button id="add1" on-click="_addAllocationDetails" style="margin-top:18px;margin-left: 10px;" raised>Add</paper-button>
                        </div>
                        <div class="card1">
                            <table id="allocrooms">
                                <tr>
                                    <th>Rooms</th>
                                    <th>Peak</th>
                                    <th>Non-Peak</th>
                                    <th>High</th>
                                    <th>Action</th>
                                </tr>
                                <tbody>
                                    <template is="dom-repeat" items="[[allocationDetails]]" as="item">
                                        <tr>
                                            <td style="text-align:center">{{item.roomname}}</td>
                                            <td style="text-align:center">{{item.pk}}</td>
                                            <td style="text-align:center">{{item.npk}}</td>
                                            <td style="text-align:center">{{item.high}}</td>
                                            <td style="text-align:center">
                                                <paper-icon-button id="{{item.id}}" style="color: blue;width: 35px;height: 35px;" icon="my-icons::create" on-tap="_openedit"></paper-icon-button>
                                                <paper-icon-button id="{{item.id}}" style="color: red;width: 35px;height: 35px;" icon="my-icons:delete-forever" on-tap="_opendelete"></paper-icon-button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                        <div style="margin-left:16px">
                            <h3>SEASONS</h3>
                        </div>
                        <!-- <x-array-data-provider items="{{seasonDetails}}" size="200"></x-array-data-provider> -->
                        <div style="margin-bottom: 20px;margin-left:16px">
                            <paper-input type="date" style="width: 200px; float: left;" label="Start" id="startValue" value="{{startValue}}" max="{{endValue}}"
                                date-format="DD-MMMM-YYYY"></paper-input>
                            <paper-input type="date" style="width: 200px; float: left; margin-left: 5px;" label="End" id="endValue" value="{{endValue}}"
                                min="{{startValue}}" date-format="DD-MMMM-YYYY"></paper-input>
                            <paper-dropdown-menu style="cursor:pointer;margin-left: 10px;" always-float-label label="Season" id="season">
                                <paper-listbox slot="dropdown-content" class="dropdown-content" selected="{{seasonAdd}}" attr-for-selected="name">
                                    <paper-item name="Peak Season">Peak Season</paper-item>
                                    <paper-item name="High Season">High Season</paper-item>
                                </paper-listbox>
                            </paper-dropdown-menu>
                            <!-- <paper-dropdown-input id="season" value="{{season}}" always-float-label style="width: 200px; margin-left: 5px;" label="Season">
                                <paper-item>Peak Season</paper-item>
                                <paper-item>High Season</paper-item>
                            </paper-dropdown-input> -->
                            <paper-button id="add" on-click="_addSeasonDetails" raised>Add</paper-button>
                        </div>
                        <div class="card1">
                            <table id="allocseason">
                                <tr>
                                    <th>Season Start</th>
                                    <th>Season End</th>
                                    <th>Season </th>
                                    <th>Action</th>
                                </tr>
                                <tbody>
                                    <template is="dom-repeat" items="[[seasonDetails]]" as="item">
                                        <tr>
                                            <td style="text-align:center">{{item.startValue}}</td>
                                            <td style="text-align:center">{{item.endValue}}</td>
                                            <td style="text-align:center">{{item.season}}</td>
                                            <td style="text-align:center">
                                                <paper-icon-button id="{{item.id}}" style="color: blue;width: 35px;height: 35px;" icon="my-icons::create" on-tap="_openeditSeason"></paper-icon-button>
                                                <paper-icon-button id="{{item.id}}" style="color: red;width: 35px;height: 35px;" icon="my-icons:delete-forever" on-tap="_opendeleteSeason"></paper-icon-button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                        <br>
                        <div style="font-size:smaller">
                            <iron-icon icon="my-icons:flag" slot="prefix" style="width:18px; height:18px;"></iron-icon>
                            <span id="created">Created by:</span>
                            {{created_by}} &nbsp;
                            <time-ago datetime$="{{_timeStampToDateTime(createdAt)}}">{{_timeStampToDateTime(createdAt)}}</time-ago>
                        </div>
                        <div style="font-size:smaller">
                            <iron-icon icon="my-icons:update" slot="prefix" style="width:18px; height:18px;"></iron-icon>
                            <span id="created">Last Modified by:</span>
                            {{updated_by}} &nbsp;
                            <time-ago datetime$="{{_timeStampToDateTime(updatedAt)}}">{{_timeStampToDateTime(updatedAt)}}</time-ago>
                        </div>
                    </div>
                </div>
                <paper-fab id="submit" noink on-tap="_openSave" style="float: right;" icon="my-icons:check" class="blue"></paper-fab>
            </app-header-layout>
            <!-- save -->

            <paper-dialog id="allocationSave" no-cancel-on-outside-click>
                <h3 style="text-align: center">Save Changes?</h3>
                <hr>
                <paper-button id="button" on-tap="_update" style="color:blue;">Yes</paper-button>
                <paper-button id="button" on-tap="_closeModal" style="float:right;color: black">No</paper-button>
            </paper-dialog>

            <paper-dialog id="allocationDelete" no-cancel-on-outside-click>
                <h3 style="text-align: center">Confirm to Delete?</h3>
                <hr>
                <paper-button id="button" on-tap="_delete" style="color: red">Yes</paper-button>
                <paper-button id="button" on-tap="_closeModal" style="float:right;color: blue">No</paper-button>
            </paper-dialog>

            <paper-dialog id="successModal" no-close-on-esc no-close-on-outside-click>
                <h3 style="text-align: center">Deleted Successfully</h3>
                <hr>
                <a href="/allocation/group/{{prevRoute}}">
                    <paper-button id="button" on-tap="_closeModal" style="float: right;color: blue">Ok</paper-button>
                </a>
            </paper-dialog>

            <paper-dialog id="successAddModal" no-cancel-on-outside-click>
                <h3 style="text-align: center">Added Successfully</h3>
                <hr>
                <a href="/allocation/group/{{prevRoute}}">
                    <paper-button id="button" on-tap="_closeModal" style="float: right;color: blue">Ok</paper-button>
                </a>
            </paper-dialog>

            <paper-dialog id="successUpdate" no-cancel-on-outside-click>
                <h3 style="text-align: center">Updated Successfully</h3>
                <hr>
                <a href="/allocation/group/{{prevRoute}}">
                    <paper-button id="button" on-tap="_closeModal" style="float: right;color: black">Ok</paper-button>
                </a>
            </paper-dialog>

            <paper-dialog id="openEdit" no-cancel-on-outside-click>
                <h3 style="text-align: center">{{header}}</h3>
                <paper-input type="number" value="{{pkedit}}" always-float-label label="Peak" style="margin-top:-5px;"></paper-input>
                <paper-input type="number" value="{{npkedit}}" always-float-label label="Non-Peak" style="margin-top:-5px;"></paper-input>
                <paper-input type="number" value="{{highedit}}" always-float-label label="High" style="margin-top:-5px;"></paper-input>
                <paper-button id="button" on-tap="_updateObj" style="float: right; padding-right: 16px;color: blue;font-size: smaller">Update</paper-button>
                <paper-button id="button" on-tap="_closeModal" style="float: right; padding: 5px;color: black;font-size: smaller">Cancel</paper-button>
            </paper-dialog>

            <paper-dialog id="opendelete" no-cancel-on-outside-click>
                <h3 style="text-align: center;">Remove {{header}}?</h3>
                <paper-input type="number" value="{{pk}}" always-float-label label="Peak" style="margin-top:-5px;" readonly></paper-input>
                <paper-input type="number" value="{{npk}}" always-float-label label="Non-Peak" style="margin-top:-5px;" readonly></paper-input>
                <paper-input type="number" value="{{high}}" always-float-label label="High" style="margin-top:-5px;" readonly></paper-input>
                <paper-button id="button" on-tap="_deleterooms" style="float: right; padding-right: 16px;color: red;font-size: smaller">Delete</paper-button>
                <paper-button id="button" on-tap="_closeModal" style="float: right; padding: 5px;color: black;font-size: smaller">Cancel</paper-button>
            </paper-dialog>

            <paper-dialog id="openEditSeason" no-cancel-on-outside-click>
                <h3 style="text-align: center">{{hotelseason}} Season</h3>
                <paper-input type="date" style="margin-top:5px;width: 200px;" label="Start" value="{{startValues}}" max="{{endValues}}" date-format="DD-MMMM-YYYY"></paper-input>
                <paper-input type="date" style="margin-top:5px;width: 200px;" label="End" value="{{endValues}}" min="{{startValues}}" date-format="DD-MMMM-YYYY"></paper-input>
                <paper-dropdown-menu style="cursor:pointer;width: 200px;margin-top: 5px;" always-float-label label="Season" id="season">
                    <paper-listbox slot="dropdown-content" class="dropdown-content" selected="{{seasonAdds}}" attr-for-selected="name">
                        <paper-item name="Peak Season">Peak Season</paper-item>
                        <paper-item name="High Season">High Season</paper-item>
                    </paper-listbox>
                </paper-dropdown-menu>
                <div style="padding:16px;">
                    <paper-button id="button" on-tap="_updateObjSeason" style="float: right; padding-right: 16px;color: blue;font-size: smaller">Update</paper-button>
                    <paper-button id="button" on-tap="_closeModal" style="float: right; padding: 5px;color: black;font-size: smaller">Cancel</paper-button>
                </div>
            </paper-dialog>

            <paper-dialog id="opendeleteSeason" no-cancel-on-outside-click>
                <h3 style="text-align: center;">Remove {{seasonAdds}}?</h3>
                <paper-input type="date" value="{{startValues}}" always-float-label label="Peak" style="margin-top:-5px;" readonly></paper-input>
                <paper-input type="date" value="{{endValues}}" always-float-label label="Non-Peak" style="margin-top:-5px;" readonly></paper-input>
                <paper-input value="{{seasonAdds}}" always-float-label label="High" style="margin-top:-5px;" readonly></paper-input>
                <paper-button id="button" on-tap="_deleteSeason" style="float: right; padding-right: 16px;color: red;font-size: smaller">Delete</paper-button>
                <paper-button id="button" on-tap="_closeModal" style="float: right; padding: 5px;color: black;font-size: smaller">Cancel</paper-button>
            </paper-dialog>
        </app-drawer-layout>
        <iron-ajax verbose id="ajax" method="[[method]]" on-response="_handleResponse"></iron-ajax>
    </template>
    <script>
        Polymer({
            is: 'my-allocation-edit',

            properties: {
                seasondate: {
                    type: Array,
                    value: []
                },
                seasonDetails: {
                    type: Array,
                    notify: true,
                    value: [],
                },
                allocationDetails: {
                    type: Array,
                    notify: true,
                    value: []
                },
                newArray: {
                    type: Array,
                    value: [],
                    notify: true
                },
                newArraySeason: {
                    type: Array,
                    value: [],
                    notify: true
                },
                id: {
                    type: Number,
                    value: 0
                },
                addid: {
                    type: Number,
                    value: 0
                },
                addidSeason: {
                    type: Number,
                    value: 0
                },
                editKey: String,
                route: Object,
                prevRoute: String,
                modifiedBy: String,
                items: Array,
                index: Number,
                idarray: String,
                seasonId: String,
                itemsSeason: Array,
                indexSeason: String,
                seasonAdd: String,
                seasonAdds: String,
                accountKey: String,
            },
            observers: ['_hotelChanged(hotel,accountKey)', '_onkeyChanged(editKey)'],
            _hotelChanged(e, f) {
                if (e && f) {
                    this.room = null;
                    this.peak = null;
                    this.pdays = null;
                    this.nonpeak = null;
                    this.nonpdays = null;
                    this.startValue = null;

                    this.endValue = null;
                    this.$.ajaxRoom.method = 'GET';
                    this.$.ajaxRoom.url = '/hotel/filterHotel/' + e;
                    this.$.ajaxRoom.generateRequest();

                    this.method = 'GET';
                    this.urluser = '/user/getkey/' + f;
                    this.$.ajax.handleAs = "json";
                    this.$.ajax.generateRequest();
                }
            },

            displayLabels: function (e) {
                return e.base.join(', ');
            },
            _userLoaded(data) {
                if (data.detail.response.data) {
                    this.createdBy = data.detail.response.data.name;
                    this.modifiedBy = data.detail.response.data.name;
                }
            },
            _allocationLoaded(data) {
                if (data.detail.response.data) {
                    this.allocations = data.detail.response.data;
                    this.group = data.detail.response.data.group;
                    this.hotel = data.detail.response.data.hotel;
                    this.hotelname = data.detail.response.data.hotelname;
                    this.pk_coff = data.detail.response.data.pk_coff;
                    this.npk_coff = data.detail.response.data.npk_coff;
                    this.high_coff = data.detail.response.data.high_coff;
                    var _rangeDate = Polymer.dom(this.root).querySelector("#rangeDate");
                    _rangeDate.dateFrom = new Date(data.detail.response.data.dateFrom);
                    _rangeDate.dateTo = new Date(data.detail.response.data.dateTo);
                    this.note = data.detail.response.data.note;
                    var roomdetails = data.detail.response.data.rooms;
                    var seasons = data.detail.response.data.seasondate;
                    this.createdAt = data.detail.response.data.createdAt;
                    this.updatedAt = data.detail.response.data.updatedAt;
                    this.created_by = data.detail.response.data.created_by;
                    this.updated_by = data.detail.response.data.updated_by;
                    this.addid = roomdetails.length + 1;
                    for (var i = 0; i < roomdetails.length; i++) {
                        if (this.newArray.length !== roomdetails.length) {
                            if (roomdetails[i].id) {
                                this.newArray = roomdetails;
                            } else {
                                this.newArray.push({
                                    id: i,
                                    room: roomdetails[i].room,
                                    roomname: roomdetails[i].roomname,
                                    pk: roomdetails[i].pk,
                                    npk: roomdetails[i].npk,
                                    high: roomdetails[i].high
                                });
                            }
                        }
                    }
                    this.allocationDetails = this.newArray;

                    this.addidSeason = seasons.length + 1;
                    for (var index = 0; index < seasons.length; index++) {
                        if (this.newArraySeason.length !== seasons.length) {
                            if (seasons[index].id) {
                                this.newArraySeason = seasons;
                            } else {
                                this.newArraySeason.push({
                                    id: index,
                                    startValue: seasons[index].startValue,
                                    endValue: seasons[index].endValue,
                                    season: seasons[index].season
                                });
                            }
                        }
                    }
                    this.seasonDetails = this.newArraySeason;
                }
            },
            _openedit(e) {
                this.$.opendeleteSeason.opened = false;
                this.$.opendelete.opened = false;
                this.$.openEditSeason.opened = false;
                this.$.openEdit.opened = true;
                this.items = e.model.__data.item;
                this.index = e.model.__data.index;
                this.header = this.items.roomname;
                this.idarray = this.items.room;
                this.pkedit = this.items.pk;
                this.npkedit = this.items.npk;
                this.highedit = this.items.high;
                Polymer.dom(this.root).querySelector("#remarks").disabled = true;
                Polymer.dom(this.root).querySelector("#rangeDate").disabled = true;
                Polymer.dom(this.root).querySelector("#pk-off").disabled = true;
                Polymer.dom(this.root).querySelector("#npk-off").disabled = true;
                Polymer.dom(this.root).querySelector("#high-off").disabled = true;
                Polymer.dom(this.root).querySelector("#room").disabled = true;
                Polymer.dom(this.root).querySelector("#pk").disabled = true;
                Polymer.dom(this.root).querySelector("#npk").disabled = true;
                Polymer.dom(this.root).querySelector("#high").disabled = true;
                Polymer.dom(this.root).querySelector("#startValue").disabled = true;
                Polymer.dom(this.root).querySelector("#endValue").disabled = true;
                Polymer.dom(this.root).querySelector("#season").disabled = true;
                Polymer.dom(this.root).querySelector("#add").disabled = true;
                Polymer.dom(this.root).querySelector("#add1").disabled = true;
                Polymer.dom(this.root).querySelector("#submit").disabled = true;
            },
            _updateObj() {
                this.$.opendeleteSeason.opened = false;
                this.$.opendelete.opened = false;
                this.$.openEditSeason.opened = false;
                this.$.openEdit.opened = false;
                if (this.items.room === this.idarray) {
                    this.splice("newArray", this.index, 1);
                    var data = {
                        id: this.items.id,
                        room: this.idarray,
                        roomname: this.header,
                        pk: this.pkedit,
                        npk: this.npkedit,
                        high: this.highedit
                    };
                    this.newArray.push(data);
                    this.notifyPath("allocationDetails", this.newArray);
                    this.notifySplices("allocationDetails");
                    Polymer.dom(this.root).querySelector("#remarks").disabled = false;
                    Polymer.dom(this.root).querySelector("#rangeDate").disabled = false;
                    Polymer.dom(this.root).querySelector("#pk-off").disabled = false;
                    Polymer.dom(this.root).querySelector("#npk-off").disabled = false;
                    Polymer.dom(this.root).querySelector("#high-off").disabled = false;
                    Polymer.dom(this.root).querySelector("#room").disabled = false;
                    Polymer.dom(this.root).querySelector("#pk").disabled = false;
                    Polymer.dom(this.root).querySelector("#npk").disabled = false;
                    Polymer.dom(this.root).querySelector("#high").disabled = false;
                    Polymer.dom(this.root).querySelector("#startValue").disabled = false;
                    Polymer.dom(this.root).querySelector("#endValue").disabled = false;
                    Polymer.dom(this.root).querySelector("#season").disabled = false;
                    Polymer.dom(this.root).querySelector("#add").disabled = false;
                    Polymer.dom(this.root).querySelector("#add1").disabled = false;
                    Polymer.dom(this.root).querySelector("#submit").disabled = false;
                }
            },
            _opendelete(e) {
                this.$.opendeleteSeason.opened = false;
                this.$.opendelete.opened = false;
                this.$.openEditSeason.opened = false;
                this.$.openEdit.opened = false;
                this.$.opendelete.opened = true;
                var data = e.model.__data.item;
                this.index = e.model.__data.index;
                this.idarray = data.room;
                this.header = data.roomname;
                this.pk = data.pk;
                this.npk = data.npk;
                this.high = data.high;
                Polymer.dom(this.root).querySelector("#remarks").disabled = true;
                Polymer.dom(this.root).querySelector("#rangeDate").disabled = true;
                Polymer.dom(this.root).querySelector("#pk-off").disabled = true;
                Polymer.dom(this.root).querySelector("#npk-off").disabled = true;
                Polymer.dom(this.root).querySelector("#high-off").disabled = true;
                Polymer.dom(this.root).querySelector("#room").disabled = true;
                Polymer.dom(this.root).querySelector("#pk").disabled = true;
                Polymer.dom(this.root).querySelector("#npk").disabled = true;
                Polymer.dom(this.root).querySelector("#high").disabled = true;
                Polymer.dom(this.root).querySelector("#startValue").disabled = true;
                Polymer.dom(this.root).querySelector("#endValue").disabled = true;
                Polymer.dom(this.root).querySelector("#season").disabled = true;
                Polymer.dom(this.root).querySelector("#add").disabled = true;
                Polymer.dom(this.root).querySelector("#add1").disabled = true;
                Polymer.dom(this.root).querySelector("#submit").disabled = true;
            },
            _deleterooms() {
                this.$.opendeleteSeason.opened = false;
                this.$.openEdit.opened = false;
                this.$.openEditSeason.opened = false;
                this.$.opendelete.opened = false;
                this.splice("allocationDetails", this.index, 1);
                this.notifySplices("allocationDetails");
                Polymer.dom(this.root).querySelector("#remarks").disabled = false;
                Polymer.dom(this.root).querySelector("#rangeDate").disabled = false;
                Polymer.dom(this.root).querySelector("#pk-off").disabled = false;
                Polymer.dom(this.root).querySelector("#npk-off").disabled = false;
                Polymer.dom(this.root).querySelector("#high-off").disabled = false;
                Polymer.dom(this.root).querySelector("#room").disabled = false;
                Polymer.dom(this.root).querySelector("#pk").disabled = false;
                Polymer.dom(this.root).querySelector("#npk").disabled = false;
                Polymer.dom(this.root).querySelector("#high").disabled = false;
                Polymer.dom(this.root).querySelector("#startValue").disabled = false;
                Polymer.dom(this.root).querySelector("#endValue").disabled = false;
                Polymer.dom(this.root).querySelector("#season").disabled = false;
                Polymer.dom(this.root).querySelector("#add").disabled = false;
                Polymer.dom(this.root).querySelector("#add1").disabled = false;
                Polymer.dom(this.root).querySelector("#submit").disabled = false;
            },
            _openeditSeason(e) {
                this.$.opendeleteSeason.opened = false;
                this.$.openEditSeason.opened = true;
                this.$.openEdit.opened = false;
                this.$.opendelete.opened = false;
                this.itemsSeason = e.model.__data.item;
                this.indexSeason = e.model.__data.index;
                this.seasonId = this.itemsSeason.id;
                this.startValues = this.itemsSeason.startValue;
                this.endValues = this.itemsSeason.endValue;
                this.seasonAdds = this.itemsSeason.season;
                Polymer.dom(this.root).querySelector("#remarks").disabled = true;
                Polymer.dom(this.root).querySelector("#rangeDate").disabled = true;
                Polymer.dom(this.root).querySelector("#pk-off").disabled = true;
                Polymer.dom(this.root).querySelector("#npk-off").disabled = true;
                Polymer.dom(this.root).querySelector("#high-off").disabled = true;
                Polymer.dom(this.root).querySelector("#room").disabled = true;
                Polymer.dom(this.root).querySelector("#pk").disabled = true;
                Polymer.dom(this.root).querySelector("#npk").disabled = true;
                Polymer.dom(this.root).querySelector("#high").disabled = true;
                Polymer.dom(this.root).querySelector("#startValue").disabled = true;
                Polymer.dom(this.root).querySelector("#endValue").disabled = true;
                Polymer.dom(this.root).querySelector("#season").disabled = true;
                Polymer.dom(this.root).querySelector("#add").disabled = true;
                Polymer.dom(this.root).querySelector("#add1").disabled = true;
                Polymer.dom(this.root).querySelector("#submit").disabled = true;

            },
            _updateObjSeason() {
                this.$.opendeleteSeason.opened = false;
                this.$.openEdit.opened = false;
                this.$.opendelete.opened = false;
                this.$.openEditSeason.opened = false;
                if (this.itemsSeason.id === this.seasonId) {
                    this.splice("seasonDetails", this.indexSeason, 1);
                    var data = {
                        id: this.itemsSeason.id,
                        startValue: this.startValues,
                        endValue: this.endValues,
                        season: this.seasonAdds
                    };
                    this.seasonDetails.push(data);
                    this.notifyPath("seasonDetails", this.seasonDetails);
                    this.notifySplices("seasonDetails");
                }
                Polymer.dom(this.root).querySelector("#remarks").disabled = false;
                Polymer.dom(this.root).querySelector("#rangeDate").disabled = false;
                Polymer.dom(this.root).querySelector("#pk-off").disabled = false;
                Polymer.dom(this.root).querySelector("#npk-off").disabled = false;
                Polymer.dom(this.root).querySelector("#high-off").disabled = false;
                Polymer.dom(this.root).querySelector("#room").disabled = false;
                Polymer.dom(this.root).querySelector("#pk").disabled = false;
                Polymer.dom(this.root).querySelector("#npk").disabled = false;
                Polymer.dom(this.root).querySelector("#high").disabled = false;
                Polymer.dom(this.root).querySelector("#startValue").disabled = false;
                Polymer.dom(this.root).querySelector("#endValue").disabled = false;
                Polymer.dom(this.root).querySelector("#season").disabled = false;
                Polymer.dom(this.root).querySelector("#add").disabled = false;
                Polymer.dom(this.root).querySelector("#add1").disabled = false;
                Polymer.dom(this.root).querySelector("#submit").disabled = false;
            },
            _opendeleteSeason(e) {
                if (e) {
                    this.$.openEdit.opened = false;
                    this.$.opendelete.opened = false;
                    this.$.openEditSeason.opened = false;
                    this.$.opendeleteSeason.opened = true;
                    this.itemsSeason = e.model.__data.item;
                    this.indexSeason = e.model.__data.index;
                    this.seasonId = this.itemsSeason.id;
                    this.startValues = this.itemsSeason.startValue;
                    this.endValues = this.itemsSeason.endValue;
                    this.seasonAdds = this.itemsSeason.season;
                    Polymer.dom(this.root).querySelector("#remarks").disabled = true;
                    Polymer.dom(this.root).querySelector("#rangeDate").disabled = true;
                    Polymer.dom(this.root).querySelector("#pk-off").disabled = true;
                    Polymer.dom(this.root).querySelector("#npk-off").disabled = true;
                    Polymer.dom(this.root).querySelector("#high-off").disabled = true;
                    Polymer.dom(this.root).querySelector("#room").disabled = true;
                    Polymer.dom(this.root).querySelector("#pk").disabled = true;
                    Polymer.dom(this.root).querySelector("#npk").disabled = true;
                    Polymer.dom(this.root).querySelector("#high").disabled = true;
                    Polymer.dom(this.root).querySelector("#startValue").disabled = true;
                    Polymer.dom(this.root).querySelector("#endValue").disabled = true;
                    Polymer.dom(this.root).querySelector("#season").disabled = true;
                    Polymer.dom(this.root).querySelector("#add").disabled = true;
                    Polymer.dom(this.root).querySelector("#add1").disabled = true;
                    Polymer.dom(this.root).querySelector("#submit").disabled = true;
                }
            },
            _deleteSeason() {
                this.$.opendeleteSeason.opened = false;
                this.$.openEdit.opened = false;
                this.$.opendelete.opened = false;
                this.$.openEditSeason.opened = false;
                this.splice("seasonDetails", this.indexSeason, 1);
                this.notifySplices("seasonDetails");
                Polymer.dom(this.root).querySelector("#remarks").disabled = false;
                Polymer.dom(this.root).querySelector("#rangeDate").disabled = false;
                Polymer.dom(this.root).querySelector("#pk-off").disabled = false;
                Polymer.dom(this.root).querySelector("#npk-off").disabled = false;
                Polymer.dom(this.root).querySelector("#high-off").disabled = false;
                Polymer.dom(this.root).querySelector("#room").disabled = false;
                Polymer.dom(this.root).querySelector("#pk").disabled = false;
                Polymer.dom(this.root).querySelector("#npk").disabled = false;
                Polymer.dom(this.root).querySelector("#high").disabled = false;
                Polymer.dom(this.root).querySelector("#startValue").disabled = false;
                Polymer.dom(this.root).querySelector("#endValue").disabled = false;
                Polymer.dom(this.root).querySelector("#season").disabled = false;
                Polymer.dom(this.root).querySelector("#add").disabled = false;
                Polymer.dom(this.root).querySelector("#add1").disabled = false;
                Polymer.dom(this.root).querySelector("#submit").disabled = false;
            },
            _groupLoaded(data) {
                if (data.detail.response) {
                    this.groupItems = data.detail.response.data;
                }
            },
            _openSave() {
                this.$.allocationSave.opened = true;
            },
            _openDelete() {
                this.$.allocationDelete.opened = true;
            },
            _closeModal() {
                this.$.openEditSeason.opened = false;
                this.$.allocationSave.opened = false;
                this.$.allocationDelete.opened = false;
                this.$.opendeleteSeason.opened = false;
                this.$.successModal.opened = false;
                this.$.successUpdate.opened = false;
                this.$.openEdit.opened = false;
                this.$.opendelete.opened = false;
                Polymer.dom(this.root).querySelector("#remarks").disabled = false;
                Polymer.dom(this.root).querySelector("#rangeDate").disabled = false;
                Polymer.dom(this.root).querySelector("#pk-off").disabled = false;
                Polymer.dom(this.root).querySelector("#npk-off").disabled = false;
                Polymer.dom(this.root).querySelector("#high-off").disabled = false;
                Polymer.dom(this.root).querySelector("#room").disabled = false;
                Polymer.dom(this.root).querySelector("#pk").disabled = false;
                Polymer.dom(this.root).querySelector("#npk").disabled = false;
                Polymer.dom(this.root).querySelector("#high").disabled = false;
                Polymer.dom(this.root).querySelector("#startValue").disabled = false;
                Polymer.dom(this.root).querySelector("#endValue").disabled = false;
                Polymer.dom(this.root).querySelector("#season").disabled = false;
                Polymer.dom(this.root).querySelector("#add").disabled = false;
                Polymer.dom(this.root).querySelector("#add1").disabled = false;
                Polymer.dom(this.root).querySelector("#submit").disabled = false;
            },
            _update() {
                if (this.hotel) {
                    if (this.editKey) {
                        var _dateFromXX = new Date(this.dateFrom);
                        var _dateFrom = _dateFromXX.getFullYear() + "-" + ("0" + (_dateFromXX.getMonth() + 1)).slice(-2) + "-" + ("0" + _dateFromXX.getDate()).slice(-2)
                        var _dateToXX = new Date(this.dateTo);
                        var _dateTo = _dateToXX.getFullYear() + "-" + ("0" + (_dateToXX.getMonth() + 1)).slice(-2) + "-" + ("0" + _dateToXX.getDate()).slice(-2)

                        this.method = 'PUT';
                        this.$.ajax.url = '/allocation/update/' + this.editKey;
                        this.$.ajax.contentType = "application/json";
                        this.$.ajax.body = {
                            group: this.group,
                            hotelname: this.hotelname,
                            dateFrom: _dateFrom,
                            dateTo: _dateTo,
                            pk_coff: this.pk_coff,
                            npk_coff: this.npk_coff,
                            high_coff: this.high_coff,
                            rooms: this.allocationDetails,
                            note: this.note,
                            seasondate: this.seasonDetails,
                            created_by: this.created_by,
                            updated_by: this.modifiedBy,
                        };
                        this.$.ajax.generateRequest();
                        this.$.allocationSave.opened = false;
                        this.$.successUpdate.opened = true;
                        this.url = '/allocation/dummy';
                    }
                    else {
                        this.msg = "All fields required";
                    }
                }
            },
            _delete() {
                if (this.editKey) {
                    this.method = 'DELETE';
                    this.$.ajax.url = '/allocation/delete/' + this.editKey;
                    this.$.ajax.generateRequest();
                    this.url = '/allocation/dummy';
                    this.$.allocationDelete.opened = false;
                    this.$.successModal.opened = true;
                }
            },
            toggleDrawer() {
                this.dispatchEvent(new CustomEvent('toggleDrawer', {
                    bubbles: true, composed: true, detail: {
                        narrow: this.$.narrow
                    }
                }));
                this.$.narrow = !this.$.narrow;
            },
            _onkeyChanged() {
                if (this.editKey) {
                    this.newArray = [];
                    this.newArraySeason = [];
                    this.seasonDetails = [];
                    this.allocationDetails = [];
                    this.$.getdata.generateRequest();
                }
            },
            _handleResponse() { },
            _timeStampToDateTime(ts) {
                return new Date(ts);
            },
            _roomsLoaded(data) {
                if (data.detail.response) {
                    this.roomItems = data.detail.response.data.room;
                }
            },
            _getEditPrevRouteLink(e) {
                return '/allocation/group/' + e.toString();
            },

            _addAllocationDetails(e) {
                if (this.$.room.selectedItemLabel !== '' && this.$.pk.value !== '' && this.$.npk.value) {
                    var id = this.addid += 1;
                    var roomdata = {
                        id: id,
                        room: this.$.room.value,
                        roomname: this.$.room.selectedItemLabel,
                        pk: this.$.pk.value,
                        npk: this.$.npk.value,
                        high: this.$.high.value
                    }
                    this.allocationDetails.push(roomdata);
                    this.notifyPath("allocationDetails", this.allocationDetails);
                    this.notifySplices("allocationDetails");

                    this.$.room.value = '';
                    this.$.room.selectedItem = null;
                    this.$.pk.value = '';
                    this.$.npk.value = '';
                    this.$.high.value = '';
                } else {
                    alert('Field required');
                }

            },
            _addSeasonDetails(e) {
                if (this.$.startValue.value !== '' && this.$.endValue.value !== '' && this.seasonAdd !== '') {
                    var id = this.addidSeason += 1;
                    var season = {
                        id: id,
                        startValue: this.$.startValue.value,
                        endValue: this.$.endValue.value,
                        season: this.seasonAdd
                    }
                    this.seasonDetails.push(season);
                    this.notifyPath("seasonDetails", this.seasonDetails);
                    this.notifySplices("seasonDetails");

                    this.$.startValue.value = '';
                    this.$.endValue.value = '';
                    this.seasonAdd = '';

                } else {
                    alert('Field required');
                }

            },
        })
    </script>
</dom-module>