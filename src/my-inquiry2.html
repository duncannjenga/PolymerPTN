<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/vaadin-dialog/vaadin-dialog.html">
<link rel="import" href="../bower_components/salte-dialog/salte-dialog.html">
<link rel="import" href="../bower_components/paper-dropdown-input/paper-dropdown-input.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">


<link rel="import" href="time-element.html">
<link rel="import" href="shared-styles.html">
<dom-module id="my-inquiry2">
    <template>
        <style include="shared-styles">
            :host {
                height: 100vh;
                margin: 0;
                display: flex;
                flex-direction: column;
            }
            @media (max-width: 768px) {
                div .availability {
                    margin: 16px;
                    display: flex;
                    flex-direction: column;
                    border-radius: 3px;
                }
                #dateandRoom {
                    display: flex;
                }
            }
            @media (min-width: 768px) {
                div .availability {
                    width: 765px;
                    margin: 16px auto;
                    border-radius: 3px;
                    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
                }
            }
            #hotels {
                border-collapse: collapse;
                width: 100%;
            }
            #hotels td {
                height: 25px;
                border: 1px solid rgb(100, 100, 100);
            }
            #hotels th {
                text-align: left;
                height: 25.5px;
            }
            .avatar-container-profile {
                position: relative;
                border: 2px solid darkorange;
                border-radius: 50%;
                height: 90px;
                padding: 2px;
                width: 90px;
                margin: 20px auto;
            }
            app-header {
                color: rgb(255, 255, 255);
                background-color: darkorange;
            }
            hr {
                background-color: #eee;
                border: 0 none;
                color: #eee;
                height: 1px;
            }

            hr#alloc {
                height: 1px;
                border: 1px dashed black;
            }

            hr#alloc1 {
                height: 1px;
                border: 1px dashed black;
            }

            hr#block {
                height: 1px;
                border: 1px dashed black;

            }

            hr#block1 {
                height: 1px;
                border: 1px dashed black;

            }

            .dateclass {
                background-color: #1B5E20;
                color: white;
            }
            .hotel {
                position: absolute;
                width: 14.5em;
                max-width: 14.5em;
                left: 2em;
                border-bottom: 1px solid;
                text-align: left;
            }
            .room {
                position: absolute;
                width: 13.4em;
                max-width: 13.4em;
                left: 16.6em;
                border-bottom: 1px solid;
                text-align: left;
            }
            .detail {
                text-align: center;
                border: 1px solid rgb(100, 100, 100);
            }
            .trdetail:nth-child(even) {
                background-color: #c0c0c0;
            }
            .trdetail:nth-child(odd) {
                background-color: white;
            }
            #hotels td:hover {
                cursor: pointer;
                background-color: navajowhite;
            }
            .detailgreen:hover {
                opacity: 0.5;
                filter: alpha(opacity=100);
                /* For IE8 and earlier */
            }
            .detailred:hover {
                opacity: 0.5;
                filter: alpha(opacity=100);
                /* For IE8 and earlier */
            }
            detailyellow:hover {
                opacity: 0.5;
                filter: alpha(opacity=100);
                /* For IE8 and earlier */
            }
            .detailgreen {
                text-align: center;
                background: url(/images/colorgreen.png);
                opacity: 1.0;
                filter: alpha(opacity=50);
                background-repeat: no-repeat;
                background-size: 90% 90%;
                background-position: center;
                /* color: black; */
            }
            .detailred {
                text-align: center;
                background: url(/images/colorred.png);
                opacity: 1.0;
                filter: alpha(opacity=50);
                background-repeat: no-repeat;
                background-size: 90% 90%;
                background-position: center;
                /* color: white; */
            }
            .detailyellow {
                text-align: center;
                background: url(/images/coloryellow.png);
                opacity: 1.0;
                filter: alpha(opacity=50);
                background-repeat: no-repeat;
                background-size: 90% 90%;
                background-position: center;
                /* color: white; */
            }
            #table {
                overflow: auto;
            }
            .table {
                width: auto;
                margin-left: 27.8em;
                overflow: auto;
            }
            #moreDetails {
                width: 30%;
            }
            paper-dialog {
                background-color: rgb(245, 245, 245);
                border-top-left-radius: 5px;
                border-top-right-radius: 5px;
                border-bottom-right-radius: 5px;
                border-bottom-left-radius: 5px;
                box-shadow: 0.5px;
            }
            #moreDetails #header {
                background-color: rgb(255, 255, 255);
                height: 30px;
                border-bottom: 1px solid rgb(196, 196, 196);
                padding: 5px;
                padding-top: 15px;
                /* -webkit-border-top-left-radius: 5px;
                -webkit-border-top-right-radius: 5px;
                -moz-border-radius-topleft: 5px;
                -moz-border-radius-topright: 5px;
                border-top-left-radius: 5px;
                border-top-right-radius: 5px; */
            }
            #moreDetails #footer {
                margin-bottom: 0;
                margin-top: 37px;
                background-color: rgb(255, 255, 255);
                border-top: 1px solid rgb(196, 196, 196);
                -webkit-border-bottom-right-radius: 5px;
                -webkit-border-bottom-left-radius: 5px;
                -moz-border-radius-bottomright: 5px;
                -moz-border-radius-bottomleft: 5px;
                border-bottom-right-radius: 5px;
                border-bottom-left-radius: 5px;
            }

            #overlay {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 2;
            }
        </style>
        <iron-ajax auto url="{{urluser}}" handle-as="json" method="GET" on-response="_userLoaded"></iron-ajax>

        <!-- group -->
        <iron-ajax auto url="{{urlGroup}}" handle-as="json" method="GET" on-response="_groupLoaded"></iron-ajax>
        <iron-ajax auto url="{{urlAgent}}" handle-as="json" method="GET" on-response="_agentLoaded"></iron-ajax>
        <!-- <iron-ajax auto url="{{urlJoin}}" params='{}' handle-as="json" method="GET" on-response="_joinLoaded" loading="{{loadingData}}" debounce-duration="300"></iron-ajax> -->
        <!-- allocation -->
        <iron-ajax id="workspace" url="{{urlFilterworkspace}}" handle-as="json" method="GET" on-response="_urlFilterworkspaceloaded"></iron-ajax>
        <iron-ajax id="startalloc" url="{{urlFilterStart}}" handle-as="json" method="GET" on-response="_urlFilterStartloaded"></iron-ajax>
        <iron-ajax id="endalloc" url="{{urlFilterend}}" handle-as="json" method="GET" on-response="_urlFilterend"></iron-ajax>
        <!-- availability -->
        <iron-ajax id="startavail" url="{{Startavail}}" handle-as="json" method="GET" on-response="_startavailloaded"></iron-ajax>
        <iron-ajax id="endavail" url="{{Endavail}}" handle-as="json" method="GET" on-response="_endavailloaded"></iron-ajax>
        <!-- blockings -->
        <iron-ajax id="startblock" url="{{Startblockings}}" handle-as="json" method="GET" on-response="_startblockloaded"></iron-ajax>
        <iron-ajax id="endblock" url="{{Endblockings}}" handle-as="json" method="GET" on-response="_endblockloaded"></iron-ajax>
        <iron-pages selected="[[route.path]]" attr-for-selected="name" fallback-selection="view404" role="main">
            <div name="">
                <app-header-layout fullbleed has-scrolling-region>
                    <app-header fixed slot="header">
                        <app-toolbar>
                            <paper-icon-button class="menu" icon="my-icons:menu" drawer-toggle on-tap="toggleDrawer"></paper-icon-button>
                            <div main-title>Agent Inquiry</div>
                        </app-toolbar>
                    </app-header>

                    <!-- <iron-ajax auto url="src/sampleData.json" on-response="_handleResponse"></iron-ajax> -->

                    <div class="card">
                        <div style="display: inline;" id="dateandRoom">
                            <div style="display: flex">
                                <div style="display: flex">
                                    <template is="dom-if" if="{{checkRole(role)}}">
                                        <paper-dropdown-input label="Select Group" items='[[groupItems]]' filter-property="group" value="{{group}}">
                                            <template>
                                                <template is="dom-repeat" items="[[items]]" as="item">
                                                    <paper-item>[[item.group]]</paper-item>
                                                </template>
                                            </template>
                                        </paper-dropdown-input>
                                        <paper-dropdown-input style="margin-left: 10px;" label="Select Agent" items='[[agentsload]]' filter-property="code" value="{{code}}">
                                            <template>
                                                <template is="dom-repeat" items="[[items]]" as="item">
                                                    <paper-item label="[[item.code]]">[[item.name]]</paper-item>
                                                </template>
                                            </template>
                                        </paper-dropdown-input>
                                    </template>
                                    <div style="display: flex; margin-left: 20px;">
                                        <paper-input label="Check in" type="date" value="{{checkin}}" max="{{checkout}}">
                                            <iron-icon icon="my-icons:date-range" slot="prefix"></iron-icon>
                                        </paper-input>
                                    </div>
                                    <div style="display: flex; margin-left: 20px;">
                                        <paper-input label="Check out" type="date" value="{{checkout}}" min="{{checkin}}">
                                            <iron-icon icon="my-icons:date-range" slot="prefix"></iron-icon>
                                        </paper-input>
                                    </div>
                                    <paper-button id="inquire" class="search" style="margin-top: 23px;" on-tap="_submitInquiry">
                                        <iron-icon icon="my-icons:search"></iron-icon>
                                        Find
                                    </paper-button>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div id="overlay">
                            <paper-spinner id="spinner" active></paper-spinner>
                        </div>
                        <div id="errorMsgDiv" style="display: none;">
                            <iron-icon icon="my-icons:error-outline"></iron-icon>
                            &nbsp;{{validationMessage}}
                            <iron-icon icon="my-icons:close" style="float: right;margin-right:10px;width: 20px;height: 20px;color:gray;cursor: pointer"
                                on-tap="closeerror"></iron-icon>
                        </div>
                        <div>
                            <div class="table">
                                <table id="hotels" style="display: none">
                                </table>
                            </div>
                        </div>
                </app-header-layout>
        </iron-pages>
        <paper-dialog id="moreDetails" horizontal-align="left" vertical-align="top">
            <div id="header">
                <span style="font-size: 25px; margin-left: 5px;">{{hotel}}</span>
            </div>
            <div>
                <div style="margin-bottom: 5px;">Room Type:
                    <span style="margin-left: 55px;"> {{rooms}}</span>
                </div>
                <div style="margin-bottom: 5px;">Room Status:
                    <span style="margin-left: 45px">{{status}}</span>
                </div>
                <div style="margin-bottom: 5px;">Date:
                    <span style="margin-left: 95px">{{cdate}}</span>
                </div>
                <div id="peakseason">Season:
                    <span style="margin-left:77px">{{season}}</span>
                </div>
            </div>
            <div>
                <div>
                    <b style="font-size: 16px;">Room Details</b>
                </div>
                <hr id="alloc">
                <div id="allocation">
                    <div style="font-size: 14px;">
                        <b>Allocation</b>
                    </div>
                    <div>Room Qty:
                        <span style="margin-left: 65px">{{allocation}}</span>
                    </div>
                    <div id="cutoff"> Cut-Off Date:
                        <span style="margin-left: 50px">{{cutoffdate}}</span>
                    </div>
                </div>
                <!-- <hr id="alloc1"> -->
                <hr id="block">
                <div id="blocking">
                    <div style="font-size: 14px;">
                        <b>Blocking</b>
                    </div>
                    <div>Room Qty:
                        <span style="margin-left: 65px">{{blocking}}</span>
                    </div>
                    <div id="cancellation"> Cancellation Date:
                        <span style="margin-left: 15px">{{cancel}}</span>
                    </div>
                </div>
                <hr id="block1">
            </div>
            <div id="footer">
                <br>
            </div>
        </paper-dialog>
    </template>

    <script>
        Polymer({
            is: 'my-inquiry2',
            properties: {
                code: String,
                checkin: { type: String, observer: 'checkinChange' },
                checkout: String,
                checkoutMax: String,
                stardate: String,
                enddate: String,
                hotelId: String,
                groupworkspace: Object,
                accountKey: String,
                status: String,
                from: String,
            },
            observers: [
                '_endCheckout(checkout)',
                '_tappedChanged(tapped)',
                '_tappedChangedC(opened)',
                '_createTable(checkin,checkout,data)'
            ],
            ready() {
                this.urlGroup = 'group/read';
                this.urluser = '/user/getkey/' + this.accountKey;
                this.urlAgent = '/agent/read';
                Polymer.dom(this.root).querySelector("#overlay").style.display = 'none';
                Polymer.dom(this.root).querySelector("#spinner").active = false;
                Polymer.dom(this.root).querySelector("#inquire").disabled = false;

            },
            _userLoaded(data) {
                if (data.detail.response.data) {
                    this.group = data.detail.response.data.group;
                    this.agent = data.detail.response.data.agent;
                    this.role = data.detail.response.data.role;
                }
            },
            _agentLoaded(data) {
                if (data.detail.response.data) {
                    this.agentsload = data.detail.response.data;
                    Polymer.dom(this.root).querySelector("#hotels").setAttribute("style", "display:none");
                }
            },
            checkRole(c) {
                if (c) {
                    if (c === "Admin" || c === "Staff") return true;
                    else { }
                }
            },
            checkinChange(e) {
                if (e) {
                    Polymer.dom(this.root).querySelector("#hotels").setAttribute("style", "display:none");
                    this.from = e;
                    var _maxDate = new Date(e);
                    _maxDate.setMonth(_maxDate.getMonth() + 1);
                    this.checkoutMax = _maxDate.getFullYear() + "-" + ("0" + (_maxDate.getMonth() + 1)).slice(-2) + "-" + ("0" + (_maxDate.getDate() - 1)).slice(-2)
                    Polymer.dom(this.root).querySelector("#inquire").disabled = false;
                }
            },
            _tappedChangedC(f) {
                if (this.$.moreDetails.opened == true) {
                    this.$.moreDetails.opened = false;
                }
            },
            _tappedChanged(e) {
                var [hotel, rooms, stat, nonpeak, peak, high, seasondates, blocking, cancel, pdayscutoff, nonpdayscutoff, highcutoff, currentdate, cutoffdate, ispeak] = e.split("~");
                var newdate = new Date(currentdate);
                newdate.setDate(newdate.getDate() - parseInt(nonpdayscutoff));
                var _cutoffnpeak = newdate.getFullYear() + "-" + ("0" + (newdate.getMonth() + 1)).slice(-2) + "-" + ("0" + newdate.getDate()).slice(-2);
                var dates = new Date(currentdate);
                dates.setDate(dates.getDate() - parseInt(pdayscutoff));
                var _cutoffpeak = dates.getFullYear() + "-" + ("0" + (dates.getMonth() + 1)).slice(-2) + "-" + ("0" + dates.getDate()).slice(-2);

                var highdates = new Date(currentdate);
                highdates.setDate(highdates.getDate() - parseInt(highcutoff));
                var _cutoffhigh = highdates.getFullYear() + "-" + ("0" + (highdates.getMonth() + 1)).slice(-2) + "-" + ("0" + highdates.getDate()).slice(-2);

                var currentdates = new Date(currentdate);
                var _currentDates = currentdates.getFullYear() + "-" + ("0" + (currentdates.getMonth() + 1)).slice(-2) + "-" + ("0" + currentdates.getDate()).slice(-2);
                if (ispeak || seasondates === "Peak Season") {
                    if (blocking != 0) {
                        this.allocation = peak;
                        this.season = seasondates;
                        this.cdate = _currentDates;
                        this.hotel = hotel;
                        this.rooms = rooms;
                        this.status = stat;
                        this.cancel = cancel;
                        this.blocking = blocking;
                        this.cutoffdate = _cutoffpeak;
                        Polymer.dom(this.root).querySelector("#block").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:block");
                        this.$.moreDetails.opened = true;
                    } else {
                        this.season = seasondates;
                        this.allocation = peak;
                        this.cdate = _currentDates;
                        this.hotel = hotel;
                        this.rooms = rooms;
                        this.status = stat;
                        this.cutoffdate = _cutoffpeak;
                        Polymer.dom(this.root).querySelector("#block").setAttribute("style", "display:none");
                        Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:none");
                        Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:none");
                        this.$.moreDetails.opened = true;
                    }
                } else if (ispeak || seasondates === "High Season") {
                    if (blocking != 0) {
                        this.allocation = high;
                        this.season = seasondates;
                        this.cdate = _currentDates;
                        this.hotel = hotel;
                        this.rooms = rooms;
                        this.status = stat;
                        this.cancel = cancel;
                        this.blocking = blocking;
                        this.cutoffdate = _cutoffhigh;
                        Polymer.dom(this.root).querySelector("#block").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:block");
                        this.$.moreDetails.opened = true;
                    } else {
                        this.season = seasondates;
                        this.allocation = high;
                        this.cdate = _currentDates;
                        this.hotel = hotel;
                        this.rooms = rooms;
                        this.status = stat;
                        this.cutoffdate = _cutoffhigh;
                        Polymer.dom(this.root).querySelector("#block").setAttribute("style", "display:none");
                        Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:none");
                        Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:none");
                        this.$.moreDetails.opened = true;
                    }
                } else {
                    if (blocking != 0) {
                        this.allocation = nonpeak;
                        this.season = seasondates;
                        this.cdate = _currentDates;
                        this.hotel = hotel;
                        this.rooms = rooms;
                        this.status = stat;
                        this.cancel = cancel;
                        this.blocking = blocking;
                        this.cutoffdate = _cutoffnpeak;
                        Polymer.dom(this.root).querySelector("#block").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:block");
                        this.$.moreDetails.opened = true;
                    } else {
                        this.season = seasondates;
                        this.allocation = nonpeak;
                        this.cdate = _currentDates;
                        this.hotel = hotel;
                        this.rooms = rooms;
                        this.status = stat;
                        this.cutoffdate = _cutoffnpeak;
                        Polymer.dom(this.root).querySelector("#block").setAttribute("style", "display:none");
                        Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:none");
                        Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:none");
                        this.$.moreDetails.opened = true;
                    }
                }
                if (seasondates == "") { Polymer.dom(this.root).querySelector("#peakseason").setAttribute("style", "display:none"); }
                else { Polymer.dom(this.root).querySelector("#peakseason").setAttribute("style", "display:block"); }
            },
            _hotelIdChanged(j) {
                this.stardate = this.checkin;
                this.roomSelected = j;
                this.urlFilterworkspace = '/group/filter/' + j;
                this.$.workspace.handleAs = "json";
                this.$.workspace.generateRequest();
            },
            _urlFilterworkspaceloaded(data) {
                if (data.detail.response.data) {
                    this.groupworkspace = data.detail.response.data;
                    Polymer.dom(this.root).querySelector("#hotels").setAttribute("style", "display:none");
                    Polymer.dom(this.root).querySelector("#inquire").disabled = false;
                }
            },
            _endCheckout(f) {
                if (f) {
                    Polymer.dom(this.root).querySelector("#hotels").setAttribute("style", "display:none");
                    this.to = f;
                    Polymer.dom(this.root).querySelector("#inquire").disabled = false;
                }
            },
            _submitInquiry() {
                Polymer.dom(this.root).querySelector("#overlay").style.display = 'flex';
                Polymer.dom(this.root).querySelector("#spinner").active = true;
                Polymer.dom(this.root).querySelector("#inquire").disabled = true;
                if (this.to && this.from && this.group && this.code) {
                    Polymer.dom(this.root).querySelector("#hotels").setAttribute("style", "display:block");
                    if (this.role === "Admin" || this.role === "Staff") {
                        this.urlFilterend = '/allocation/inquirySource2/' + this.from + "_" + this.to + "_" + this.group + "_" + this.code;
                        this.$.endalloc.generateRequest();
                        Polymer.dom(this.root).querySelector("#inquire").disabled = true;
                    }
                    else {
                        this.urlFilterend = '/allocation/inquirySource2/' + this.from + "_" + this.to + "_" + this.group + "_" + this.code;
                        this.$.endalloc.generateRequest();
                        Polymer.dom(this.root).querySelector("#inquire").disabled = true;
                    }
                } else {
                    var errormsg = Polymer.dom(this.root).querySelector("#errorMsgDiv");
                    errormsg.setAttribute("style", "font-size:12px; display: block; background-color:red; color:white; text-align:center; border-radius: 5px; opacity:0.5; padding:5px");
                    this.validationMessage = 'Oops!! dont leave empty fields above';
                    Polymer.dom(this.root).querySelector("#overlay").style.display = 'none';
                    Polymer.dom(this.root).querySelector("#spinner").active = false;
                    Polymer.dom(this.root).querySelector("#inquire").disabled = false;

                }
            },
            closeerror() {
                Polymer.dom(this.root).querySelector("#errorMsgDiv").setAttribute("style", "display:none");
            },
            _urlFilterend(data) {
                if (data.detail.response.data) {
                    this.data = data.detail.response.data;
                    Polymer.dom(this.root).querySelector("#overlay").style.display = 'none';
                    Polymer.dom(this.root).querySelector("#spinner").active = false;
                    Polymer.dom(this.root).querySelector("#hotels").setAttribute("style", " border-collapse: collapse;width: 100 %;transition-delay: 2s");
                }
            },
            _createTable(checkin, checkout, data) {
                var startDate = new Date(checkin); //YYYY-MM-DD
                var endDate = new Date(checkout); //YYYY-MM-DD
                var dateArr = getDateArray(startDate, endDate);
                function getDateArray(start, end) {
                    var arr = new Array();
                    var dt = new Date(start);
                    while (dt <= end) {
                        arr.push(new Date(dt));
                        dt.setDate(dt.getDate() + 1);
                    }
                    return arr;
                }
                var myDates = [];
                var myDates2 = [];
                for (var i = 0; i < dateArr.length; i++) {
                    var dates = formatDate(dateArr[i]);
                    myDates.push(dates);
                    myDates2.push(_monthFormat(dates));
                }
                function _monthFormat(e) {
                    var [y, m, d] = e.split("-");
                    if (m < 10) {
                        var finalMonth = m.substring(1, 2) - 1;
                    } else {
                        var finalMonth = m - 1;
                    }
                    var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
                    return monthNames[finalMonth] + "-" + d;
                }
                function formatDate(date) {
                    var d = new Date(date),
                        month = '' + (d.getMonth() + 1),
                        day = '' + d.getDate(),
                        year = d.getFullYear();
                    if (month.length < 2) month = '0' + month;
                    if (day.length < 2) day = '0' + day;
                    return [year, month, day].join('-');
                }

                if (data) {
                    var table = Polymer.dom(this.root).querySelector('#hotels');
                    while (table.hasChildNodes()) {
                        table.removeChild(table.lastChild);
                    }
                    //table header
                    var tr1 = document.createElement('tr');
                    var thHotel = document.createElement('th');
                    var hotelName = document.createTextNode("Hotels");
                    thHotel.appendChild(hotelName);
                    thHotel.setAttribute("class", "hotel");
                    thHotel.style.textAlign = "center";
                    tr1.appendChild(thHotel);
                    var thRoom = document.createElement('th');
                    var roomName = document.createTextNode("Rooms");
                    thRoom.appendChild(roomName);
                    thRoom.setAttribute("class", "room");
                    thRoom.style.textAlign = "center";
                    tr1.appendChild(thRoom);
                    for (var y = 0; y < myDates.length; y++) {
                        var thDates = document.createElement('td');
                        var dateHeader = document.createTextNode(myDates2[y]);
                        thDates.appendChild(dateHeader);
                        thDates.setAttribute("class", "detail");
                        tr1.appendChild(thDates);
                    }
                    table.appendChild(tr1);

                    //table header
                    //table td / data
                    data.forEach(element => {
                        var tr2 = document.createElement('tr');
                        tr2.setAttribute("class", "trdetail");
                        var tdHotel = document.createElement('th');
                        var hotel = document.createTextNode(element.hotelname);
                        tdHotel.appendChild(hotel);
                        tdHotel.setAttribute("class", "hotel");
                        tr2.appendChild(tdHotel);
                        var tdRoom = document.createElement('th');
                        var room = document.createTextNode(element.roomname);
                        tdRoom.appendChild(room);
                        tdRoom.setAttribute("class", "room");
                        tr2.appendChild(tdRoom);
                        element.dates.forEach(cdate => {
                            if (cdate.details.availability.length > 0) {
                                var tdDateData = document.createElement('td');
                                if (cdate.details.allocation.length > 0) {
                                    if (cdate.details.seasondetails.length > 0) {
                                        if ((cdate.details.seasondetails.length > 0 ? cdate.details.seasondetails[0].season : "") === "Peak Season") {
                                            if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "green") {
                                                if (cdate.details.blocking.length > 0) {
                                                    var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                    tdDateData.appendChild(alloc);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailgreen");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                                else {
                                                    var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)));
                                                    tdDateData.appendChild(allocs);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailgreen");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                            }
                                            else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "red") {
                                                if (cdate.details.blocking.length > 0) {
                                                    var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                    tdDateData.appendChild(alloc);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailred");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                                else {
                                                    var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)));
                                                    tdDateData.appendChild(allocs);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailred");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                            }
                                            else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "yellow") {
                                                if (cdate.details.blocking.length > 0) {
                                                    var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                    tdDateData.appendChild(alloc);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailyellow");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                                else {
                                                    var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)));
                                                    tdDateData.appendChild(allocs);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailyellow");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                            }
                                        } else {
                                            if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "green") {
                                                if (cdate.details.blocking.length > 0) {
                                                    var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                    tdDateData.appendChild(alloc);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailgreen");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                                else {
                                                    var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0)));
                                                    tdDateData.appendChild(allocs);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailgreen");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                            }
                                            else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "red") {
                                                if (cdate.details.blocking.length > 0) {
                                                    var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                    tdDateData.appendChild(alloc);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailred");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                                else {
                                                    var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0)));
                                                    tdDateData.appendChild(allocs);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailred");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                            }
                                            else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "yellow") {
                                                if (cdate.details.blocking.length > 0) {
                                                    var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                    tdDateData.appendChild(alloc);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailyellow");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                                else {
                                                    var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0)));
                                                    tdDateData.appendChild(allocs);
                                                    tdDateData.style.textAlign = "center";
                                                    tdDateData.setAttribute("class", "detailyellow");
                                                    tdDateData.style.color = "black";
                                                    tr2.appendChild(tdDateData);
                                                }
                                            }
                                        }
                                    } else {
                                        if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "green") {
                                            if (cdate.details.blocking.length > 0) {
                                                var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                tdDateData.appendChild(alloc);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailgreen");
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            }
                                            else {
                                                var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)));
                                                tdDateData.appendChild(allocs);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailgreen");
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                        else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "red") {
                                            if (cdate.details.blocking.length > 0) {
                                                var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                tdDateData.appendChild(alloc);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailred");
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            }
                                            else {
                                                var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)));
                                                tdDateData.appendChild(allocs);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailred");
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                        else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "yellow") {
                                            if (cdate.details.blocking.length > 0) {
                                                var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                tdDateData.appendChild(alloc);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailyellow");
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            }
                                            else {
                                                var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)));
                                                tdDateData.appendChild(allocs);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailyellow");
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                    }
                                } else {
                                    if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "green") {
                                        if (cdate.details.blocking.length > 0) {
                                            var alloc = document.createTextNode(parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                            tdDateData.appendChild(alloc);
                                            tdDateData.style.textAlign = "center";
                                            tdDateData.setAttribute("class", "detailgreen");
                                            tdDateData.style.color = "black";
                                            tr2.appendChild(tdDateData);
                                        } else {
                                            var allocs = document.createTextNode(0);
                                            tdDateData.appendChild(allocs);
                                            tdDateData.style.textAlign = "center";
                                            tdDateData.setAttribute("class", "detailgreen");
                                            tdDateData.style.color = "black";
                                            tr2.appendChild(tdDateData);
                                        }
                                    }
                                    else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "red") {
                                        if (cdate.details.blocking.length > 0) {
                                            var allocs = document.createTextNode(parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                            tdDateData.appendChild(allocs);
                                            tdDateData.style.textAlign = "center";
                                            tdDateData.setAttribute("class", "detailred");
                                            tdDateData.style.color = "black";
                                            tr2.appendChild(tdDateData);
                                        } else {
                                            var allocsa = document.createTextNode(0);
                                            tdDateData.appendChild(allocsa);
                                            tdDateData.style.textAlign = "center";
                                            tdDateData.setAttribute("class", "detailred");
                                            tdDateData.style.color = "black";
                                            tr2.appendChild(tdDateData);
                                        }
                                    }
                                    else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "yellow") {
                                        if (cdate.details.blocking.length > 0) {
                                            var alloca = document.createTextNode(parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                            tdDateData.appendChild(alloca);
                                            tdDateData.style.textAlign = "center";
                                            tdDateData.setAttribute("class", "detailyellow");
                                            tdDateData.style.color = "black";
                                            tr2.appendChild(tdDateData);
                                        } else {
                                            var allocas = document.createTextNode(0);
                                            tdDateData.appendChild(allocas);
                                            tdDateData.style.textAlign = "center";
                                            tdDateData.setAttribute("class", "detailyellow");
                                            tdDateData.style.color = "black";
                                            tr2.appendChild(tdDateData);
                                        }

                                    }
                                }
                                tdDateData.setAttribute('id', element.hotelname + "~" + element.roomname + "~" + (cdate.details.availability.length > 0 ? cdate.details.availability[0].status : "No Update") + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0) + "~" + (cdate.details.seasondetails.length > 0 ? cdate.details.seasondetails[0].season : "") + "~" + (cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0) + "~" + (cdate.details.blocking.length > 0 ? cdate.details.blocking[0].cancel : "none") + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_coff : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_coff : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_coff : 0) + "~" + cdate.date + "~" + (cdate.details.seasondetails.length > 0 ? true : false));
                                var self = this;
                                tdDateData.addEventListener('mouseover', function (e) {
                                    self.tapped = e.target.id;
                                });
                                tdDateData.addEventListener('mouseout', function (f) {
                                    self.opened = f.target.id;
                                });
                            }
                            else {
                                var tdDateData = document.createElement('td');
                                if (cdate.details.allocation.length > 0) {
                                    if (cdate.details.seasondetails.length > 0) {
                                        if ((cdate.details.seasondetails.length > 0 ? cdate.details.seasondetails[0].season : "") === "Peak Season") {
                                            if (cdate.details.blocking.length > 0) {
                                                var alloca = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                tdDateData.appendChild(alloca);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            } else {
                                                var allocas = document.createTextNode(parseInt(cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0));
                                                tdDateData.appendChild(allocas);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            }
                                        } else {
                                            if (cdate.details.blocking.length > 0) {
                                                var alloca = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                tdDateData.appendChild(alloca);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            } else {
                                                var allocas = document.createTextNode(parseInt(cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0));
                                                tdDateData.appendChild(allocas);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.style.color = "black";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                    }
                                    else {
                                        if (cdate.details.blocking.length > 0) {
                                            var alloca = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                            tdDateData.appendChild(alloca);
                                            tdDateData.style.textAlign = "center";
                                            tdDateData.style.color = "black";
                                            tr2.appendChild(tdDateData);
                                        } else {
                                            var allocas = document.createTextNode(parseInt(cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0));
                                            tdDateData.appendChild(allocas);
                                            tdDateData.style.textAlign = "center";
                                            tdDateData.style.color = "black";
                                            tr2.appendChild(tdDateData);
                                        }
                                    }
                                } else {
                                    if (cdate.details.blocking.length > 0) {
                                        var alloca = document.createTextNode(parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                        tdDateData.appendChild(alloca);
                                        tdDateData.style.textAlign = "center";
                                        tdDateData.style.color = "black";
                                        tr2.appendChild(tdDateData);
                                    } else {
                                        var allocas = document.createTextNode(0);
                                        tdDateData.appendChild(allocas);
                                        tdDateData.style.textAlign = "center";
                                        tdDateData.style.color = "black";
                                        tr2.appendChild(tdDateData);
                                    }
                                }
                                tdDateData.setAttribute('id', element.hotelname + "~" + element.roomname + "~" + (cdate.details.availability.length > 0 ? cdate.details.availability[0].status : "No Update") + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_qty : 0) + "~" + (cdate.details.seasondetails.length > 0 ? cdate.details.seasondetails[0].season : "") + "~" + (cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0) + "~" + (cdate.details.blocking.length > 0 ? cdate.details.blocking[0].cancel : "none") + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_coff : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_coff : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].high_coff : 0) + "~" + cdate.date + "~" + (cdate.details.seasondetails.length > 0 ? true : false));
                                var self = this;
                                tdDateData.addEventListener('mouseover', function (e) {
                                    self.tapped = e.target.id;
                                });
                                tdDateData.addEventListener('mouseout', function (f) {
                                    self.opened = f.target.id;
                                });
                            }
                        });
                        table.appendChild(tr2);
                    });
                }
            },
            _groupLoaded(data) {
                if (data.detail.response.data) {
                    this.groupItems = data.detail.response.data;
                    Polymer.dom(this.root).querySelector("#hotels").setAttribute("style", "display:none");
                    Polymer.dom(this.root).querySelector("#inquire").disabled = false;
                }
            },
            toggleDrawer() {
                this.dispatchEvent(new CustomEvent('toggleDrawer', {
                    bubbles: true, composed: true, detail: {
                        narrow: this.$.narrow
                    }
                }));
                this.$.narrow = !this.$.narrow;
            },
        });
    </script>
</dom-module>