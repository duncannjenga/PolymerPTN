<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/salte-dialog/salte-dialog.html">


<link rel="import" href="shared-styles.html">
<link rel="import" href="search-bar.html">
<dom-module id="my-agent">
    <template>
        <style include="shared-styles">
            :host {
                height: 100vh;
                margin: 0;
                display: flex;
                flex-direction: column;
            }

            @media (max-width: 768px) {}


            paper-fab.fab {
                position: fixed;
                bottom: 30px;
                right: 30px;
                background-color: #3F51B5;
            }

            app-header {
                color: rgb(255, 255, 255);
                background-color: darkorange;
                /* background-color: var(--paper-indigo-500); */
                /* background-color: #388E3C; */
            }

            #tool1 {
                color: rgb(255, 255, 255);
                background-color: darkorange;
            }

            #tool2 {
                background-color: white;
            }

            .item {
                @apply --layout-horizontal;
                /* padding: 20px; */
                background-color: white;
                border-bottom: 1px solid #ddd;
                cursor: pointer;
                margin-bottom: 10px;
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }

            .pad {
                padding: 0 16px;
                @apply --layout-flex;
                @apply --layout-vertical;
            }

            #action {
                /* display: inline-block; */
                margin-top: 10px;
                float: right;
            }

            div .option {
                position: absolute;
                left: 300px;
                top: 200px;
            }

            #btn-clear {
                position: fixed;
                right: 80px;
                color: gray;
            }

            #btn-arrow {
                position: absolute;
                color: black;
            }

            #btn-menu {
                color: gray;
                position: fixed;
                right: 40px;
            }

            hr {
                background-color: #eee;
                border: 0 none;
                color: #eee;
                height: 1px;
            }

            paper-fab.blue {
                position: fixed;
                bottom: 32px;
                right: 32px;
                background-color: darkorange;
            }
        </style>

        <iron-ajax verbose id="ajax" method="[[method]]" on-response="_handleResponse"></iron-ajax>
        <iron-ajax id="ajaxGet" url="{{url}}" handle-as="json" on-response="_agentLoaded" loading="{{loadingData}}" debounce-duration="300"></iron-ajax>

        <app-header-layout fullbleed has-scrolling-region>
            <app-header fixed slot="header">
                <app-toolbar>
                    <paper-icon-button class="menu" icon="my-icons:menu" drawer-toggle on-tap="toggleDrawer"></paper-icon-button>
                    <div main-title>Agent</div>
                    <template is="dom-if" if="{{openSearch}}">
                        <paper-icon-button id="clear" class="menu" icon="my-icons:close" drawer-toggle on-tap="toggleReturn"></paper-icon-button>
                    </template>
                    <paper-icon-button id="search" class="menu" icon="my-icons:search" drawer-toggle on-tap="toggleSearch"></paper-icon-button>
                </app-toolbar>
            </app-header>

            <iron-scroll-document id="threshold">

                <!-- <div class="card">
                    <paper-input label="Code" value="{{code}}"></paper-input>
                    <paper-input label="Name" value="{{name}}"></paper-input>
                </div> -->

                <div class="card">
                    <table width="100%">
                        <tr>
                            <td>Code</td>
                            <td>Name</td>
                        </tr>
                        <template is="dom-repeat" items="[[agent]]" as="item">

                            <tr>
                                <td>
                                    [[item.code]]
                                </td>
                                <td>
                                    [[item.name]]
                                </td>
                            </tr>
                        </template>
                    </table>
                </div>
            </iron-scroll-document>
            <paper-fab on-tap="_openAdd" style=" float: right; " class="blue" icon="my-icons:save"></paper-fab>
        </app-header-layout>
        <salte-dialog id="addModal">
            <h2>Add Agent</h2>
            <paper-input label="Code" value="{{code}}"></paper-input>
            <paper-input label="Name" value="{{name}}"></paper-input>
            <span class="buttons" style="float: right">
                <paper-button dialog-dismiss>Cancel</paper-button>
                <paper-button dialog-confirm on-tap="_submit">Accept</paper-button>
            </span>
        </salte-dialog>
    </template>

    <script>
        Polymer({
            is: 'my-agent',
            properties: {
                route: Object,
                routeData: Object,
                accountKey: String,
                agentDetails: {
                    type: Array,
                    notify: true,
                    value: [],
                },
                editingAgentDetails: Object,
            },
            ready() {
                this.url = '/agent/read';
                this.editingAgentDetails = null;
                Polymer.dom(this.root).querySelector('#ajaxGet').generateRequest();
            },
            _openAdd() {
                this.$.addModal.opened = true;
            },
            _agentLoaded(data) {
                if (data.detail.response) {
                    this.agent = data.detail.response.data;
                }
            },
            _handleResponse(data) {
                Polymer.dom(this.root).querySelector('#ajaxGet').generateRequest();
            },
            _submit() {
                this.method = 'POST';
                this.$.ajax.url = '/agent/add';
                this.$.ajax.contentType = "application/json";
                this.$.ajax.body = {

                    code: this.code,
                    name: this.name
                };
                this.$.ajax.generateRequest();
                this.code = '';
                this.name = '';
            },

        });
    </script>
</dom-module>